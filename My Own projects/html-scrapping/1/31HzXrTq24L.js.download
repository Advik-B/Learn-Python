'use strict';mix_d("VSESpotlightCards__vse-multi-video-card-desktop:vse-multi-video-card-desktop__-I4mHrNO","exports tslib @p/A @c/logger @c/metrics @c/scoped-dom @p/a-modal @c/aui-untrusted-ajax @p/gw-video-orchestrator".split(" "),function(I,z,T,U,J,V,W,X,Y){function r(c){return c&&"object"===typeof c&&"default"in c?c:{"default":c}}var a=r(T),Z=r(U),A=r(V),aa=r(W),ba=r(X),ca=r(Y),K={fiveColumn:"_vse-multi-video-card-desktop_style_fiveColumn__U4qm5",vseFeedCarousel:"_vse-multi-video-card-desktop_style_vseFeedCarousel__1JH03",
vseVideoWidgetContainer:"_vse-multi-video-card-desktop_style_vseVideoWidgetContainer__br1yo",vseFeedCarouselViewport:"_vse-multi-video-card-desktop_style_vseFeedCarouselViewport__3GRaW",spotlightFeedCarouselCard:"_vse-multi-video-card-desktop_style_spotlight-feed-carousel-card__57oDV",vseFeedCarouselCard:"_vse-multi-video-card-desktop_style_vseFeedCarouselCard__3vBMn",vseFeedCarouselControl:"_vse-multi-video-card-desktop_style_vseFeedCarouselControl__A5iL1",vseFeedCarouselControlLeft:"_vse-multi-video-card-desktop_style_vseFeedCarouselControlLeft__2sSlm",
vseFeedCarouselControlRight:"_vse-multi-video-card-desktop_style_vseFeedCarouselControlRight__ACMa7",vseFeedArrowRight:"_vse-multi-video-card-desktop_style_vseFeedArrowRight__35S1g",vseFeedArrowLeft:"_vse-multi-video-card-desktop_style_vseFeedArrowLeft__2Y0WT",vseFeedScrollbar:"_vse-multi-video-card-desktop_style_vseFeedScrollbar__2z6zN",vseFeedScrollbarTrack:"_vse-multi-video-card-desktop_style_vseFeedScrollbarTrack__2G_Ky",vseFeedScrollbarThumb:"_vse-multi-video-card-desktop_style_vseFeedScrollbarThumb__e2rem",
vseFeedCarouselScrollbar:"_vse-multi-video-card-desktop_style_vseFeedCarouselScrollbar__90X1j",vseFeedCarouselShelf:"_vse-multi-video-card-desktop_style_vseFeedCarouselShelf__3pIOr",vseSeeMoreLink:"_vse-multi-video-card-desktop_style_vseSeeMoreLink__1sX_Z",vseVideoWidgetHeaderBlock:"_vse-multi-video-card-desktop_style_vseVideoWidgetHeaderBlock__1qLH1",vseVideoWidgetHeader:"_vse-multi-video-card-desktop_style_vseVideoWidgetHeader__3mDBX",vseWidgetPageState:"_vse-multi-video-card-desktop_style_vseWidgetPageState__1UCt2",
vseVideoWidgetTitleText:"_vse-multi-video-card-desktop_style_vseVideoWidgetTitleText__2sQCp",vseCarouselItem:"_vse-multi-video-card-desktop_style_vseCarouselItem__Ddzmm",vseVideoImageWrapper:"_vse-multi-video-card-desktop_style_vseVideoImageWrapper__2ZCX7",vseProfilePlaceholder:"_vse-multi-video-card-desktop_style_vseProfilePlaceholder__2MIa-",vseVideoThumbnailProfile:"_vse-multi-video-card-desktop_style_vseVideoThumbnailProfile__ecyw8",vseWidgetLbVideoBlock:"_vse-multi-video-card-desktop_style_vseWidgetLbVideoBlock__2S1On",
vseWidgetLbVideoBlockWrapper:"_vse-multi-video-card-desktop_style_vseWidgetLbVideoBlockWrapper__3Fvaj",vseWidgetLbSpinner:"_vse-multi-video-card-desktop_style_vseWidgetLbSpinner__1KyPR",vseWidgetLbAbsolute:"_vse-multi-video-card-desktop_style_vseWidgetLbAbsolute__2SUcn",vseWidgetPopoverContainer:"_vse-multi-video-card-desktop_style_vseWidgetPopoverContainer__3Oy-b",vseNoRightPadding:"_vse-multi-video-card-desktop_style_vseNoRightPadding__aZWRa",vsePlaceholderLeft:"_vse-multi-video-card-desktop_style_vsePlaceholderLeft__UipPl",
vsePlaceholderRight:"_vse-multi-video-card-desktop_style_vsePlaceholderRight__uAiME",vsePlaceholder:"_vse-multi-video-card-desktop_style_vsePlaceholder__2p1SX",vseVerticalLightbox:"_vse-multi-video-card-desktop_style_vseVerticalLightbox__YJaIH",vseRemoveAbsolute:"_vse-multi-video-card-desktop_style_vseRemoveAbsolute__1KDpw"},t=function(c){c=JSON.stringify(c).replace(/\\\\/g,"");J.event(JSON.parse(c),"vsemetrics_widgetcards","vse.VSECardsEvents.5",{ssd:!1})},da=function(c){return function(b){return a["default"].$.extend({eventSource:c.eventSource,
placementContext:c.placementContext,clientId:c.clientId,timestamp:new Date,userAgentData:navigator.userAgent,titleSessionId:"0",videoAsin:"",videoAsinList:c.videoAsinList||"",creativeId:""},b)}},b={pageType:"",clientPrefix:"",deviceType:"",placement:"",metricsPlacement:"",cardId:"",buildCsmPayload:function(c){}},l=function(c,a){void 0===a&&(a=1);try{J.count("spotlight:csm:"+b.clientPrefix+":"+c,a)}catch(g){w("failed to post CSM metric","ERROR")}},n=function(c,a){void 0===a&&(a=1);l(c+":"+b.deviceType,
a)},w=function(a,f){Z["default"].log("VSESpotlightCards: "+a+". Client prefix: "+b.clientPrefix+", Page type: "+b.pageType,f,"VSESpotlightCards")},L=function(c,f,g){try{if(a["default"].$("."+b.cardId).length){var d=!1,h=f.map(function(a){return a.contentId}).join(","),e=b.buildCsmPayload({eventName:b.clientPrefix+":cardWidgetRendered",intPayload:1,videoAsinList:h});t(e);l("cardWidgetRendered",1);var k=function(){for(var c=g.carouselItemClassName,d=0;d<f.length;d++)if(!f[d].impressionRecorded){var e=
a["default"].$("."+b.cardId+" ."+c+":nth-child("+(d+1)+")");if(a["default"].onScreen(e,0))e=b.buildCsmPayload({eventName:b.clientPrefix+":thumbnailImpression",intPayload:d,videoAsin:f[d].contentId}),t(e),f[d].impressionRecorded=!0;else break}},p=function(){if(d)a["default"].off(a["default"].constants.BROWSER_EVENTS.SCROLL,p);else{var f=b.buildCsmPayload({eventName:b.clientPrefix+":cardWidgetScrolledInView",intPayload:1,videoAsinList:h}),e=a["default"].$("."+b.cardId+" ."+g.carouselItemClassName).first();
e&&a["default"].onScreen(e,0)&&(t(f),f=a["default"].now()-c,l("cardWidgetScrolledInViewTime",f),n("cardWidgetScrolledInView"),d=!0,k())}};p();a["default"].on(a["default"].constants.BROWSER_EVENTS.SCROLL,p);g.widgetMetricsHandler(k,function(a){var c=b.buildCsmPayload({eventName:b.clientPrefix+":"+a+":paginationButtonClicked",intPayload:1});l(a+":paginationButtonClicked",1);t(c)})}}catch(ea){w("Error occurred while emitting widget metrics "+ea,"ERROR"),l("widgetMetricsEmissionError")}},E=function(a,
b,g,d,h){void 0===h&&(h=3);h--;ba["default"].post(a,{accepts:"*/*",contentType:"application/json;charset=UTF-8",timeout:3E3},b).then(function(a){g(a)}).catch(function(c){0<h?E(a,b,g,d,h):d(c)})},fa=function(a,b){a="/gp/mobile/tag/?ref=vse_spotlight"+a+b.replace("/?_encoding=UTF8","");E(a,{},function(){},function(){})},M={},m,q,B=!1,C,N,F,u,k,v,G=!1,x,D,ja=function(c,f,g,d){return z.__awaiter(void 0,void 0,void 0,function(){var h,e;return z.__generator(this,function(ma){try{v=g;k=f;u=c;b.deviceType=
u?"Mobile":"Desktop";h=a["default"].now();e=A["default"].cardRoot.getElementsByClassName("spotlight-video-data-item");if(!e)return l("noCardsIngressDom"),y(),[2];if((C=A["default"].cardRoot.getElementsByClassName(k.vseWidgetPageState))&&C[0]&&C[0].dataset){q=C[0].dataset;m=O(e,q);b.pageType="Spotlight";b.clientPrefix=b.pageType.toLowerCase();b.placement=(q.client||"Spotlight")+"Card-"+b.deviceType;b.metricsPlacement=(a["default"].capabilities.mobile?a["default"].capabilities.isAmazonApp?"mobile_app":
"mobile_web":a["default"].capabilities.tablet?a["default"].capabilities.isAmazonApp?"tablet_app":"tablet_web":"desktop_web")+"."+b.placement+".vse_spotlight";b.cardId=q.cardId;D="spotlight-component-feed-carousel-"+b.cardId;if(!a["default"].capabilities.video)return l("videoNotSupported"),[2];n("cardWidgetRendered");b.buildCsmPayload=da({placementContext:b.metricsPlacement,clientId:"VSE",eventSource:"VSEWidgetCards",stringPayload:""});u?L(h,m,d):(a["default"].$("."+b.cardId+" ."+k.vsePlaceholder+
" .a-fixed-right-grid-inner").addClass(k.vseNoRightPadding),ha(e,q,h,d),a["default"].trigger("spotlight-card-ready-"+D));ia(e,q)}else l("pageStateNotFound"),y()}catch(p){w("fatal exception has occurred. Exception details: "+p,"FATAL"),l("widgetFatalException"),y()}return[2]})})},ha=function(b,f,g,d){try{a["default"].off("spotlight-carousel-items-added-"+D),a["default"].on("spotlight-carousel-items-added-"+D,function(){B||(B=!0,m=P(f),L(g,m,d))})}catch(h){H(h,b,void 0)}},P=function(a){a=A["default"].cardRoot.getElementsByClassName("spotlight-video-data-item");
return O(a)},ka=function(c,f){M={requester:"VSEWidgetCards",clientPrefix:b.clientPrefix,page:b.pageType,placement:b.placement,device:b.deviceType,metadata:{id:"vse-video-widget-card",celQueryStringParam:c.celQueryStringParam},videoDataList:m,video:{contentID:f.contentId,contentIDType:"physicalID",videoURL:f.videoUrl,imageURL:f.imageUrl,videoTitle:f.title},marketplaceID:c.marketplaceId,locale:c.locale};E(window.location.origin+"/vap/ew/componentbuilder",M,function(c){N=!0;l("preloadSuccess");a["default"].$("."+
k.vseWidgetLbVideoBlock).html(c.responseBody);a["default"].on(b.clientPrefix+":vse:player:registered",function(){F&&a["default"].trigger("vse:cards:"+b.clientPrefix+":componentbuilder:succeeded")})},function(c){n("preloadFailed");l("preloadFailed:"+c.statusCode);w("NilgiriService componentbuilder call has failed: "+c.statusCode,"FATAL");y();a["default"].trigger("vse:cards:"+b.clientPrefix+":componentbuilder:failed")})},y=function(){var a=A["default"].cardRoot.getElementsByClassName(k.vseSeeMoreLink)[0];
a&&a.classList&&a.classList.add("aok-hidden")},ia=function(c,f){var g;try{[].forEach.call(c,function(a){a.children[0].removeAttribute("target")});var d,h=0;Q();a["default"].$("."+b.cardId+" .spotlight-cards-ingress-carousel").delegate(".spotlight-carousel-item","click",function(c){B||(m=P(q),B=!0);c.preventDefault();var h=a["default"].$(c.currentTarget);c=0>h.closest("li").index()?0:h.closest("li").index();var e=m[c];e.metadata&&(d={contentId:e.contentId,title:e.metadata.title,referenceLinkTitle:e.metadata.title,
videoUrl:e.metadata.videoURL,duration:e.metadata.formattedDuration,imageUrl:e.metadata.videoImageUrl,fallbackSearchQuery:e.metadata.fallbackSearchQuery,videoVoteContainer:{},refTag:"spotlight-ingress"+c,relatedProducts:e.metadata.relatedProductsAsins,seeMoreText:e.metadata.seeMoreText,seeMoreLink:e.metadata.seeMoreLink,index:c,$el:h},h=b.buildCsmPayload({eventName:b.clientPrefix+":cardWidgetClicked",intPayload:1,videoAsin:d.contentId}),n("cardWidgetClicked"),t(h),fa(c,f.celQueryStringParam),u?a["default"].trigger("vse:cards:"+
b.cardId+":secondary:view:open"):(g=aa["default"].get(a["default"].$("."+b.cardId+" #spotlight-widget-popover-trigger")),a["default"].objectIsEmpty(g)?l("lbNotFoundDesktop"):g.show()))});a["default"].on(b.clientPrefix+":vse:player:registered",function(){a["default"].$("#"+k.vseWidgetPopoverContainer+" ."+k.vseWidgetLbVideoBlock).first().animate({opacity:1})});a["default"].on("a:popover:afterShow:spotlight-widget-popover",function(e){try{if(a["default"].$(e.popover.$popover).addClass(a["default"].$("#"+
k.vseWidgetPopoverContainer).data("cssClass")),h++,F=!0,1===h){a["default"].$(e.popover.$popover).addClass(k.vseVerticalLightbox);var l=a["default"].now();g&&g.refresh();ka(f,d);a["default"].on("vse:cards:"+b.clientPrefix+":componentbuilder:succeeded",function(){R(d);a["default"].$(e.popover.$popover).addClass(k.vseRemoveAbsolute);u&&""===d.relatedProducts&&""!==d.seeMoreLink&&""!==d.seeMoreText&&a["default"].trigger("vse:"+b.clientPrefix+":seeMoreBlock:init",d.seeMoreLink,d.seeMoreText);var c=a["default"].now()-
l;n("cardWidgetPopoverContentWaitTime",c)});a["default"].on("vse:cards:"+b.clientPrefix+":componentbuilder:failed",function(){S(c);g?g.hide():a["default"].trigger("vse:cards:"+b.cardId+":secondary:view:close");a["default"].delay(function(){window.open(d.fallbackSearchQuery,"_blank")},500)})}else R(d)}catch(p){H(p,c,g)}});a["default"].on("a:popover:beforeHide:spotlight-widget-popover",function(){F=!1;N?(a["default"].trigger("vse:"+b.clientPrefix+":page:lightBoxClosed"),null!=v&&x&&v.unsubscribe(x)):
n("cardWidgetLBClosedBeforeAjax")});a["default"].declarative("vse-widget-carousel-see-more","click touch",function(){u&&(G=!0);a["default"].$("."+b.cardId+" .spotlight-cards-ingress-carousel").find("."+k.vseCarouselItem).first().click();n("seeMoreLinkClicked");var c=b.buildCsmPayload({eventName:b.clientPrefix+":seeMoreLinkClicked",intPayload:1});t(c)})}catch(e){H(e,c,g)}},H=function(a,b,g){w("fatal exception has occurred in LB. Exception details: "+a,"FATAL");l("lightboxOpenFatalException");y();S(b);
g&&g.hide()},S=function(a){Q();[].forEach.call(a,function(a,b){a.children&&a.children[0]&&a.children[0].setAttribute("target",m[b].metadata.fallbackSearchQuery)})},Q=function(){a["default"].$("."+b.cardId+" .spotlight-cards-ingress-carousel").undelegate(".spotlight-carousel-item","click")},O=function(a,b){var c=[];[].forEach.call(a,function(a,b){a=a.dataset;(b=a.asin)&&c.push({contentId:b,metadata:{id:a.id||"",videoImageUrl:a.videoImageUrlUnchanged||a.videoImageUrl||"",videoURL:a.videoUrl||a.videoURL||
"",title:a.title||"",formattedDuration:a.formattedDuration||"",relatedProductsAsins:a.relatedProductsAsins||"",fallbackSearchQuery:a.fallbackSearchQuery||"",seeMoreText:a.seeMoreText||"",seeMoreLink:a.seeMoreLink||""},impressionRecorded:!1})});return c},R=function(c){G&&a["default"].trigger("vse:"+b.clientPrefix+":page:watchAllClicked");G=!1;a["default"].trigger("vse:"+b.clientPrefix+":page:lightBoxOpened",{assetSpec:c,lightBoxId:""+k.vseWidgetPopoverContainer});0<a["default"].$("."+k.vseWidgetLbVideoBlock).length&&
(x=a["default"].$("."+k.vseWidgetLbVideoBlock).get(0),null!=v&&(la(x),v.elect(x)))},la=function(a){v.subscribe(a,function(a){},{buffer:0})};I._operationNames=[];I.card=function(){return z.__awaiter(void 0,void 0,void 0,function(){var c;return z.__generator(this,function(f){switch(f.label){case 0:return c={carouselItemClassName:K.vseFeedCarouselCard,widgetMetricsHandler:function(c,d){var f=a["default"].throttle(function(){c()},500,{leading:!1});a["default"].on(a["default"].constants.BROWSER_EVENTS.RESIZE,
function(){c()});a["default"].$("."+b.cardId+" .spotlight-feed-carousel-control-left").click(function(){d("left");f()});a["default"].$("."+b.cardId+" .spotlight-feed-carousel-control-right").click(function(){d("right");f()})}},[4,ja(!1,K,ca["default"],c)];case 1:return f.sent(),[2]}})})}});
